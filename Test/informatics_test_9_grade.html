<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Контрольный тест по информатике - 9 класс</title>
    <link rel="stylesheet" href="resource/test_styles_css.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Контрольный тест по информатике</h1>
            <div class="subtitle">9 класс • 25 вопросов • Одна попытка</div>
        </div>

        <div id="loginForm" class="login-form">
            <div class="form-group">
                <label for="lastName">Фамилия:</label>
                <input type="text" id="lastName" required>
            </div>
            <div class="form-group">
                <label for="firstName">Имя:</label>
                <input type="text" id="firstName" required>
            </div>
            <button class="start-btn" onclick="startTest()">Начать тест</button>
            <div id="loginError" class="error-message" style="display: none;">
                Пожалуйста, заполните все поля
            </div>
        </div>

        <div id="quizContainer" class="question-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>
            
            <div id="questionContent"></div>
        </div>

        <div id="navigation" class="navigation" style="display: none;">
            <button class="nav-btn" id="prevBtn" onclick="previousQuestion()">← Предыдущий</button>
            <div class="question-info">
                <span id="currentQuestion">1</span> из <span id="totalQuestions">25</span>
            </div>
            <button class="nav-btn" id="nextBtn" onclick="nextQuestion()">Следующий →</button>
        </div>

        <div id="submitContainer" class="submit-container">
            <div class="warning-message">
                Внимание! После отправки теста изменить ответы будет невозможно.
            </div>
            <button class="submit-btn" onclick="finishTest()">Завершить тест</button>
        </div>

        <div id="results" class="results">
            <div class="student-info">
                <h3 id="studentName"></h3>
            </div>
            <div class="score" id="score"></div>
            <div class="grade-badge" id="gradeBadge"></div>
            <div class="feedback" id="feedback"></div>
            <div class="result-summary" id="resultSummary"></div>
            <div class="details" id="details"></div>
        </div>
    </div>

    <script>
        const questions = [
            {
                id: 1,
                text: "Какое из перечисленных свойств НЕ относится к свойствам информации?",
                options: [
                    "Актуальность",
                    "Точность", 
                    "Размер файла",
                    "Достоверность"
                ],
                correct: 2,
                goal: "9.2.1.1"
            },
            {
                id: 2,
                text: "Что может произойти при продолжительном использовании компьютера?",
                options: [
                    "Улучшение зрения",
                    "Усталость глаз и нарушение осанки",
                    "Повышение иммунитета",
                    "Увеличение роста"
                ],
                correct: 1,
                goal: "9.4.1.1"
            },
            {
                id: 3,
                text: "Что такое облачные технологии?",
                options: [
                    "Технологии изучения погоды",
                    "Удаленное хранение и обработка данных через интернет",
                    "Программы для рисования облаков",
                    "Технологии полета в облаках"
                ],
                correct: 1,
                goal: "9.1.3.1"
            },
            {
                id: 4,
                text: "К чему может привести нарушение сетевого этикета?",
                options: [
                    "К улучшению отношений",
                    "К конфликтам и правовым последствиям",
                    "К повышению скорости интернета",
                    "К экономии трафика"
                ],
                correct: 1,
                goal: "9.4.2.1"
            },
            {
                id: 5,
                text: "При выборе конфигурации компьютера для игр наиболее важны:",
                options: [
                    "Мощная видеокарта и процессор",
                    "Большой монитор",
                    "Много USB-портов",
                    "Красивый корпус"
                ],
                correct: 0,
                goal: "9.1.1.1"
            },
            {
                id: 6,
                text: "Какой тип программного обеспечения нужен для работы с текстом?",
                options: [
                    "Графический редактор",
                    "Текстовый редактор",
                    "Антивирус",
                    "Браузер"
                ],
                correct: 1,
                goal: "9.1.2.1"
            },
            {
                id: 7,
                text: "Что такое база данных?",
                options: [
                    "Программа для игр",
                    "Организованное хранилище информации",
                    "Операционная система",
                    "Тип файла"
                ],
                correct: 1,
                goal: "9.2.2.1"
            },
            {
                id: 8,
                text: "Что такое 'запись' в базе данных?",
                options: [
                    "Строка таблицы с информацией об одном объекте",
                    "Столбец таблицы",
                    "Название таблицы",
                    "Размер базы данных"
                ],
                correct: 0,
                goal: "9.2.2.1"
            },
            {
                id: 9,
                text: "В какой программе удобнее всего создать простую базу данных?",
                options: [
                    "В блокноте",
                    "В электронной таблице",
                    "В графическом редакторе",
                    "В браузере"
                ],
                correct: 1,
                goal: "9.2.2.2"
            },
            {
                id: 10,
                text: "Что означает 'сортировка данных'?",
                options: [
                    "Удаление данных",
                    "Упорядочивание данных по определенному критерию",
                    "Копирование данных",
                    "Шифрование данных"
                ],
                correct: 1,
                goal: "9.2.2.3"
            },
            {
                id: 11,
                text: "Что такое 'фильтрация данных'?",
                options: [
                    "Очистка экрана",
                    "Отбор данных по заданным условиям",
                    "Сжатие файлов",
                    "Резервное копирование"
                ],
                correct: 1,
                goal: "9.2.2.3"
            },
            {
                id: 12,
                text: "Какое расширение имеют файлы программ на Python?",
                options: [
                    ".txt",
                    ".py",
                    ".exe",
                    ".doc"
                ],
                correct: 1,
                goal: "9.3.3.1"
            },
            {
                id: 13,
                text: "Как объявить одномерный массив в Python?",
                options: [
                    "array = []",
                    "list = ()",
                    "массив = {}",
                    "arr = |1,2,3|"
                ],
                correct: 0,
                goal: "9.3.3.1"
            },
            {
                id: 14,
                text: "Как получить длину массива в Python?",
                options: [
                    "array.size()",
                    "len(array)",
                    "array.length",
                    "count(array)"
                ],
                correct: 1,
                goal: "9.3.3.1"
            },
            {
                id: 15,
                text: "Что такое двумерный массив?",
                options: [
                    "Массив из двух элементов",
                    "Массив массивов (таблица)",
                    "Массив только с числами",
                    "Массив только со строками"
                ],
                correct: 1,
                goal: "9.3.3.2"
            },
            {
                id: 16,
                text: "Какой алгоритм сортировки самый простой для понимания?",
                options: [
                    "Быстрая сортировка",
                    "Сортировка пузырьком",
                    "Сортировка слиянием",
                    "Пирамидальная сортировка"
                ],
                correct: 1,
                goal: "9.3.2.1"
            },
            {
                id: 17,
                text: "Что делает библиотека PyGame?",
                options: [
                    "Создает веб-сайты",
                    "Позволяет создавать игры",
                    "Работает с базами данных",
                    "Редактирует изображения"
                ],
                correct: 1,
                goal: "9.3.3.3"
            },
            {
                id: 18,
                text: "Какая команда подключает библиотеку PyGame в Python?",
                options: [
                    "import pygame",
                    "include pygame",
                    "using pygame",
                    "add pygame"
                ],
                correct: 0,
                goal: "9.3.3.3"
            },
            {
                id: 19,
                text: "Для чего используется pygame.display.set_mode()?",
                options: [
                    "Для загрузки изображений",
                    "Для создания игрового окна",
                    "Для воспроизведения звука",
                    "Для сохранения игры"
                ],
                correct: 1,
                goal: "9.3.3.4"
            },
            {
                id: 20,
                text: "Что такое спрайт в игре?",
                options: [
                    "Звуковой эффект",
                    "Графический объект (персонаж, предмет)",
                    "Уровень сложности",
                    "Размер экрана"
                ],
                correct: 1,
                goal: "9.3.3.6"
            },
            {
                id: 21,
                text: "Как создать задний фон в PyGame?",
                options: [
                    "background.create()",
                    "screen.fill(color) или загрузить изображение",
                    "pygame.background()",
                    "set_background(image)"
                ],
                correct: 1,
                goal: "9.3.3.5"
            },
            {
                id: 22,
                text: "Что нужно для анимации персонажа в игре?",
                options: [
                    "Изменение его координат в цикле игры",
                    "Создание нового персонажа",
                    "Изменение цвета фона",
                    "Увеличение громкости звука"
                ],
                correct: 0,
                goal: "9.3.3.7"
            },
            {
                id: 23,
                text: "Что такое игровой цикл (game loop)?",
                options: [
                    "Окончание игры",
                    "Постоянно повторяющийся процесс обновления игры",
                    "Загрузка игры",
                    "Сохранение результатов"
                ],
                correct: 1,
                goal: "9.3.3.9"
            },
            {
                id: 24,
                text: "Для чего нужен подсчет очков в игре?",
                options: [
                    "Для украшения экрана",
                    "Для отслеживания прогресса игрока",
                    "Для ускорения игры",
                    "Для изменения графики"
                ],
                correct: 1,
                goal: "9.3.3.10"
            },
            {
                id: 25,
                text: "Какое преимущество дает совместная работа с документами в облаке?",
                options: [
                    "Документы становятся красивее",
                    "Несколько человек могут редактировать одновременно",
                    "Документы занимают меньше места",
                    "Документы лучше защищены от вирусов"
                ],
                correct: 1,
                goal: "9.1.3.1"
            }
        ];

        let currentQuestionIndex = 0;
        let studentAnswers = {};
        let studentName = "";
        let testStartTime = new Date();

        function startTest() {
            const lastName = document.getElementById('lastName').value.trim();
            const firstName = document.getElementById('firstName').value.trim();
            
            if (!lastName || !firstName) {
                document.getElementById('loginError').style.display = 'block';
                return;
            }
            
            studentName = `${lastName} ${firstName}`;
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('navigation').style.display = 'flex';
            
            shuffleQuestions();
            showQuestion(0);
            updateProgress();
        }

        function shuffleQuestions() {
            questions.forEach(question => {
                const correctAnswer = question.options[question.correct];
                const shuffled = [...question.options];
                
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                
                question.correct = shuffled.indexOf(correctAnswer);
                question.options = shuffled;
            });
        }

        function showQuestion(index) {
            const question = questions[index];
            const questionHTML = `
                <div class="question">
                    <h3>
                        <div class="question-number">${index + 1}</div>
                        ${question.text}
                    </h3>
                    <div class="options">
                        ${question.options.map((option, i) => `
                            <label class="option">
                                <input type="radio" name="q${question.id}" value="${i}" 
                                       ${studentAnswers[question.id] == i ? 'checked' : ''}>
                                <span class="option-text">${option}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('questionContent').innerHTML = questionHTML;
            
            document.getElementById('currentQuestion').textContent = index + 1;
            document.getElementById('prevBtn').disabled = index === 0;
            document.getElementById('nextBtn').style.display = index === questions.length - 1 ? 'none' : 'block';
            document.getElementById('submitContainer').style.display = index === questions.length - 1 ? 'block' : 'none';
            
            const radioButtons = document.querySelectorAll(`input[name="q${question.id}"]`);
            radioButtons.forEach(radio => {
                radio.addEventListener('change', () => {
                    studentAnswers[question.id] = parseInt(radio.value);
                });
            });
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
                updateProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
                updateProgress();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
        }

        function finishTest() {
            const unansweredQuestions = questions.filter(q => studentAnswers[q.id] === undefined);
            
            if (unansweredQuestions.length > 0) {
                alert(`Не отвечено на ${unansweredQuestions.length} вопрос(ов). Вы уверены, что хотите завершить тест?`);
            }
            
            if (!confirm('Вы уверены, что хотите завершить тест? Изменить ответы после этого будет невозможно.')) {
                return;
            }
            
            calculateResults();
        }

        function calculateResults() {
            let correctAnswers = 0;
            let missedGoals = [];
            
            questions.forEach(question => {
                const studentAnswer = studentAnswers[question.id];
                if (studentAnswer === question.correct) {
                    correctAnswers++;
                } else {
                    missedGoals.push({
                        questionId: question.id,
                        goal: question.goal,
                        question: question.text
                    });
                }
            });
            
            const percentage = Math.round((correctAnswers / questions.length) * 100);
            const testEndTime = new Date();
            const testDuration = Math.round((testEndTime - testStartTime) / 60000);
            
            let grade, gradeClass, feedback;
            if (percentage >= 85) {
                grade = "Отлично (5)";
                gradeClass = "grade-excellent";
                feedback = "Превосходный результат! Вы отлично усвоили программу 9 класса по информатике.";
            } else if (percentage >= 70) {
                grade = "Хорошо (4)";
                gradeClass = "grade-good";
                feedback = "Хороший результат! Материал в основном усвоен, есть небольшие пробелы.";
            } else if (percentage >= 50) {
                grade = "Удовлетворительно (3)";
                gradeClass = "grade-satisfactory";
                feedback = "Удовлетворительный результат. Рекомендуется повторить некоторые темы.";
            } else {
                grade = "Неудовлетворительно (2)";
                gradeClass = "grade-unsatisfactory";
                feedback = "Результат требует значительного улучшения. Необходимо повторить весь материал.";
            }
            
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('navigation').style.display = 'none';
            document.getElementById('submitContainer').style.display = 'none';
            document.getElementById('results').classList.add('show');
            
            document.getElementById('studentName').textContent = studentName;
            document.getElementById('score').textContent = `${correctAnswers}/${questions.length} (${percentage}%)`;
            document.getElementById('gradeBadge').textContent = grade;
            document.getElementById('gradeBadge').className = `grade-badge ${gradeClass}`;
            document.getElementById('feedback').textContent = feedback;
            
            document.getElementById('resultSummary').innerHTML = `
                <div class="result-card">
                    <h4>Правильных ответов</h4>
                    <div class="value">${correctAnswers}</div>
                </div>
                <div class="result-card">
                    <h4>Процент</h4>
                    <div class="value">${percentage}%</div>
                </div>
                <div class="result-card">
                    <h4>Время</h4>
                    <div class="value">${testDuration} мин</div>
                </div>
                <div class="result-card">
                    <h4>Оценка</h4>
                    <div class="value">${grade.split(' ')[1]}</div>
                </div>
            `;
            
            if (missedGoals.length > 0) {
                document.getElementById('details').innerHTML = `
                    <h3>Цели обучения, требующие дополнительного изучения:</h3>
                    <ul class="missed-goals">
                        ${missedGoals.map(item => `
                            <li><strong>Цель ${item.goal}:</strong> ${item.question}</li>
                        `).join('')}
                    </ul>
                `;
            } else {
                document.getElementById('details').innerHTML = `
                    <h3>Все цели обучения достигнуты! 🎉</h3>
                `;
            }
            
            saveResults({
                studentName,
                correctAnswers,
                totalQuestions: questions.length,
                percentage,
                grade,
                testDuration,
                missedGoals,
                timestamp: new Date().toLocaleString()
            });
        }

        function saveResults(results) {
            const resultHTML = `
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Результат теста - ${results.studentName}</title>
    <link rel="stylesheet" href="test-styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Результат тестирования</h1>
            <div class="subtitle">Информатика • 9 класс</div>
        </div>
        
        <div class="results show">
            <div class="student-info">
                <h3>${results.studentName}</h3>
                <p>Дата: ${results.timestamp}</p>
            </div>
            
            <div class="score">${results.correctAnswers}/${results.totalQuestions} (${results.percentage}%)</div>
            <div class="grade-badge ${results.grade.includes('5') ? 'grade-excellent' : 
                                     results.grade.includes('4') ? 'grade-good' : 
                                     results.grade.includes('3') ? 'grade-satisfactory' : 'grade-unsatisfactory'}">${results.grade}</div>
            
            <div class="result-summary">
                <div class="result-card">
                    <h4>Правильных ответов</h4>
                    <div class="value">${results.correctAnswers}</div>
                </div>
                <div class="result-card">
                    <h4>Процент</h4>
                    <div class="value">${results.percentage}%</div>
                </div>
                <div class="result-card">
                    <h4>Время</h4>
                    <div class="value">${results.testDuration} мин</div>
                </div>
                <div class="result-card">
                    <h4>Оценка</h4>
                    <div class="value">${results.grade.split(' ')[1]}</div>
                </div>
            </div>
            
            ${results.missedGoals.length > 0 ? `
            <div class="details">
                <h3>Цели обучения, требующие дополнительного изучения:</h3>
                <ul class="missed-goals">
                    ${results.missedGoals.map(item => `
                        <li><strong>Цель ${item.goal}:</strong> ${item.question}</li>
                    `).join('')}
                </ul>
            </div>
            ` : '<div class="details"><h3>Все цели обучения достигнуты! 🎉</h3></div>'}
        </div>
    </div>
</body>
</html>`;

            const blob = new Blob([resultHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `result_9grade_${results.studentName.replace(/\s+/g, '_')}_${Date.now()}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            console.log('Результаты теста для 9 класса:', results);
        }
    </script>
</body>
</html>